openapi: 3.1.0
info:
  title: API RADAR - Quantitativo de Interrupcoes Ativas
  description: |
    API para fornecimento de dados em tempo real das interrupcoes de fornecimento
    de energia eletrica ativas no sistema da Roraima Energia, conforme especificacao
    da ANEEL (Oficio Circular 14/2025-SFE/ANEEL).

    ## Visao Geral

    Esta API fornece a ANEEL dados agregados por municipio e conjunto eletrico,
    permitindo monitoramento em tempo real das ocorrencias no sistema eletrico de Roraima.

    ## Formato de Resposta ANEEL V4

    Conforme Oficio Circular 14/2025-SFE/ANEEL, a resposta segue o formato padrao:
    - `idcStatusRequisicao`: 1 (sucesso) ou 2 (erro)
    - `emailIndisponibilidade`: Email para contato em caso de problemas
    - `mensagem`: Mensagem de erro (vazio se sucesso)
    - `interrupcaoFornecimento`: Lista de interrupcoes agregadas

    ## Autenticacao

    Todas as requisicoes devem incluir o header `x-api-key` com a chave de autenticacao
    fornecida pela Roraima Energia.

    ## Rate Limiting

    - Frequencia maxima: 10 requisicoes/minuto
    - Intervalo recomendado: 5 minutos entre consultas

    ## Contato

    Em caso de indisponibilidade ou problemas, entrar em contato atraves do email
    informado no campo `emailIndisponibilidade` da resposta.
  version: 1.0.0
  contact:
    name: Equipe RADAR - Roraima Energia
    email: radar@roraimaenergia.com.br
  license:
    name: Proprietario
    url: https://roraimaenergia.com.br

servers:
  - url: https://api.roraimaenergia.com.br/radar/v1
    description: Servidor de Producao
  - url: https://api-homolog.roraimaenergia.com.br/radar/v1
    description: Servidor de Homologacao
  - url: http://localhost:8001
    description: Servidor de Desenvolvimento

tags:
  - name: Interrupcoes
    description: Endpoints relacionados a interrupcoes de fornecimento
  - name: Sistema
    description: Endpoints de sistema (health check, info)

paths:
  /quantitativointerrupcoesativas:
    get:
      operationId: getQuantitativoInterrupcoesAtivas
      summary: Quantitativo de Interrupcoes Ativas
      description: |
        Retorna o quantitativo de interrupcoes de fornecimento de energia eletrica
        ativas, agregadas por municipio e conjunto eletrico.

        ## Formato de Resposta ANEEL V4

        Conforme Oficio Circular 14/2025-SFE/ANEEL, os dados sao retornados no campo
        `interrupcaoFornecimento` com os seguintes campos por item:
        - `ideConjuntoUnidadeConsumidora`: Identificador do conjunto eletrico
        - `ideMunicipio`: Codigo IBGE do municipio (7 digitos)
        - `qtdUCsAtendidas`: Quantidade de UCs atendidas no conjunto
        - `qtdOcorrenciaProgramada`: Quantidade de UCs afetadas por interrupcoes programadas
        - `qtdOcorrenciaNaoProgramada`: Quantidade de UCs afetadas por interrupcoes nao programadas

        ## Cache

        Os dados sao atualizados a cada 5 minutos. Requisicoes dentro deste intervalo
        podem retornar dados do cache.
      tags:
        - Interrupcoes
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Requisicao processada com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InterrupcoesAtivasResponse'
              examples:
                comInterrupcoes:
                  summary: Com interrupcoes ativas
                  description: Exemplo com interrupcoes ativas em diferentes municipios
                  value:
                    idcStatusRequisicao: 1
                    emailIndisponibilidade: "radar@roraimaenergia.com.br"
                    mensagem: ""
                    interrupcaoFornecimento:
                      - ideConjuntoUnidadeConsumidora: 1
                        ideMunicipio: 1400100
                        qtdUCsAtendidas: 125000
                        qtdOcorrenciaProgramada: 150
                        qtdOcorrenciaNaoProgramada: 45
                      - ideConjuntoUnidadeConsumidora: 2
                        ideMunicipio: 1400175
                        qtdUCsAtendidas: 8500
                        qtdOcorrenciaProgramada: 0
                        qtdOcorrenciaNaoProgramada: 120
                semInterrupcoes:
                  summary: Sem interrupcoes ativas
                  description: Exemplo quando nao ha interrupcoes no sistema
                  value:
                    idcStatusRequisicao: 1
                    emailIndisponibilidade: "radar@roraimaenergia.com.br"
                    mensagem: ""
                    interrupcaoFornecimento: []
        '401':
          description: Nao autorizado - API Key ausente ou invalida
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                idcStatusRequisicao: 2
                emailIndisponibilidade: "radar@roraimaenergia.com.br"
                mensagem: "Header x-api-key e obrigatorio"
                interrupcaoFornecimento: []
        '429':
          description: Too Many Requests - Rate limit excedido
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                idcStatusRequisicao: 2
                emailIndisponibilidade: "radar@roraimaenergia.com.br"
                mensagem: "Rate limit excedido. Limite: 10 requisicoes por minuto."
                interrupcaoFornecimento: []
          headers:
            Retry-After:
              description: Segundos ate poder fazer nova requisicao
              schema:
                type: integer
                example: 45
            X-RateLimit-Limit:
              description: Limite de requisicoes por minuto
              schema:
                type: integer
                example: 10
            X-RateLimit-Remaining:
              description: Requisicoes restantes na janela atual
              schema:
                type: integer
                example: 0
        '500':
          description: Erro interno do servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                idcStatusRequisicao: 2
                emailIndisponibilidade: "radar@roraimaenergia.com.br"
                mensagem: "Erro interno do servidor. Tente novamente mais tarde."
                interrupcaoFornecimento: []

  /health:
    get:
      operationId: healthCheck
      summary: Health Check
      description: Verifica o status de saude da API e suas dependencias.
      tags:
        - Sistema
      responses:
        '200':
          description: API saudavel
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: "healthy"
                version: "1.0.0"
                checks:
                  database:
                    healthy: true
                    latency_ms: 15
                  cache:
                    status: "up"
                    item_count: 5
                    hit_rate: 0.85

  /:
    get:
      operationId: root
      summary: Informacoes da API
      description: Retorna informacoes basicas da API.
      tags:
        - Sistema
      responses:
        '200':
          description: Informacoes da API
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RootResponse'
              example:
                api: "RADAR - Interrupcoes Ativas"
                version: "1.0.0"
                docs: "/docs"

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
      description: |
        Chave de autenticacao fornecida pela Roraima Energia.

        Para obter uma chave, entre em contato com radar@roraimaenergia.com.br

  schemas:
    InterrupcoesAtivasResponse:
      type: object
      description: Resposta do endpoint de interrupcoes ativas - Formato ANEEL V4
      required:
        - idcStatusRequisicao
        - emailIndisponibilidade
        - mensagem
        - interrupcaoFornecimento
      properties:
        idcStatusRequisicao:
          type: integer
          enum: [1, 2]
          description: |
            Status da requisicao:
            - 1: Sucesso
            - 2: Erro
          example: 1
        emailIndisponibilidade:
          type: string
          format: email
          description: Email para contato em caso de problemas com a API
          example: "radar@roraimaenergia.com.br"
        mensagem:
          type: string
          description: Mensagem de erro (vazio se sucesso)
          example: ""
        interrupcaoFornecimento:
          type: array
          description: Lista de interrupcoes agregadas por municipio e conjunto eletrico
          items:
            $ref: '#/components/schemas/InterrupcaoAgregadaItem'

    InterrupcaoAgregadaItem:
      type: object
      description: Item de interrupcao agregada no formato ANEEL V4
      required:
        - ideConjuntoUnidadeConsumidora
        - ideMunicipio
        - qtdUCsAtendidas
        - qtdOcorrenciaProgramada
        - qtdOcorrenciaNaoProgramada
      properties:
        ideConjuntoUnidadeConsumidora:
          type: integer
          description: Identificador do conjunto eletrico
          example: 1
        ideMunicipio:
          type: integer
          description: |
            Codigo IBGE do municipio (7 digitos).

            Municipios de Roraima:
            - 1400050: Alto Alegre
            - 1400027: Amajari
            - 1400100: Boa Vista
            - 1400159: Bonfim
            - 1400175: Canta
            - 1400209: Caracarai
            - 1400233: Caroebe
            - 1400282: Iracema
            - 1400308: Mucajai
            - 1400407: Normandia
            - 1400456: Pacaraima
            - 1400472: Rorainopolis
            - 1400506: Sao Joao da Baliza
            - 1400605: Sao Luiz
            - 1400704: Uiramuta
          example: 1400100
          minimum: 1400000
          maximum: 1499999
        qtdUCsAtendidas:
          type: integer
          minimum: 0
          description: Quantidade de Unidades Consumidoras (UCs) atendidas no conjunto
          example: 125000
        qtdOcorrenciaProgramada:
          type: integer
          minimum: 0
          description: Quantidade de UCs afetadas por interrupcoes programadas
          example: 150
        qtdOcorrenciaNaoProgramada:
          type: integer
          minimum: 0
          description: Quantidade de UCs afetadas por interrupcoes nao programadas
          example: 45

    ErrorResponse:
      type: object
      description: Resposta de erro padrao ANEEL V4
      required:
        - idcStatusRequisicao
        - emailIndisponibilidade
        - mensagem
        - interrupcaoFornecimento
      properties:
        idcStatusRequisicao:
          type: integer
          const: 2
          description: Status de erro (sempre 2)
          example: 2
        emailIndisponibilidade:
          type: string
          format: email
          description: Email para contato
          example: "radar@roraimaenergia.com.br"
        mensagem:
          type: string
          description: Descricao do erro ocorrido
          example: "Erro de conexao com banco de dados"
        interrupcaoFornecimento:
          type: array
          description: Array vazio em caso de erro
          items:
            $ref: '#/components/schemas/InterrupcaoAgregadaItem'
          maxItems: 0

    HealthResponse:
      type: object
      description: Resposta do endpoint de health check
      required:
        - status
        - version
        - checks
      properties:
        status:
          type: string
          enum: [healthy, unhealthy, degraded]
          description: Status geral da API
          example: "healthy"
        version:
          type: string
          description: Versao da API
          example: "1.0.0"
        checks:
          type: object
          description: Status das dependencias
          properties:
            database:
              type: object
              properties:
                healthy:
                  type: boolean
                  example: true
                latency_ms:
                  type: number
                  example: 15
            cache:
              type: object
              properties:
                status:
                  type: string
                  example: "up"
                item_count:
                  type: integer
                  example: 5
                hit_rate:
                  type: number
                  example: 0.85

    RootResponse:
      type: object
      description: Informacoes basicas da API
      properties:
        api:
          type: string
          description: Nome da API
          example: "RADAR - Interrupcoes Ativas"
        version:
          type: string
          description: Versao da API
          example: "1.0.0"
        docs:
          type: string
          nullable: true
          description: URL da documentacao (null em producao)
          example: "/docs"

security:
  - ApiKeyAuth: []
