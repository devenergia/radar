# RAD-216: Setup React + TypeScript + Vite

**Fase:** 5 - Frontend
**Tipo:** Setup/Configuration
**Prioridade:** Alta
**Status:** PENDENTE
**Dependencias:** -
**Base Legal:** REN 1.137/2025 - Art. 106

## Objetivo

Configurar projeto frontend com React, TypeScript e Vite para o mapa de interrupcoes.

## Localizacao

```
frontend/
├── package.json
├── vite.config.ts
├── tsconfig.json
├── src/
│   ├── main.tsx
│   ├── App.tsx
│   ├── vite-env.d.ts
│   ├── components/
│   ├── hooks/
│   ├── services/
│   ├── types/
│   └── styles/
└── public/
    └── geojson/
```

## Especificacao

### Stack Frontend

| Tecnologia | Versao | Uso |
|------------|--------|-----|
| React | 18.x | UI Framework |
| TypeScript | 5.x | Tipagem |
| Vite | 5.x | Build Tool |
| Leaflet | 1.9.x | Mapa interativo |
| TanStack Query | 5.x | Data fetching |
| Tailwind CSS | 3.x | Styling |
| Vitest | 1.x | Testes |

## Implementacao

### package.json

```json
{
  "name": "radar-mapa-interrupcoes",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "test": "vitest",
    "test:coverage": "vitest run --coverage",
    "lint": "eslint src --ext ts,tsx",
    "format": "prettier --write src"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-leaflet": "^4.2.1",
    "leaflet": "^1.9.4",
    "@tanstack/react-query": "^5.17.0",
    "axios": "^1.6.0",
    "date-fns": "^3.0.0",
    "clsx": "^2.1.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "@types/leaflet": "^1.9.8",
    "@vitejs/plugin-react": "^4.2.0",
    "typescript": "^5.3.0",
    "vite": "^5.0.0",
    "vitest": "^1.2.0",
    "@vitest/coverage-v8": "^1.2.0",
    "@testing-library/react": "^14.1.0",
    "@testing-library/jest-dom": "^6.2.0",
    "tailwindcss": "^3.4.0",
    "postcss": "^8.4.0",
    "autoprefixer": "^10.4.0",
    "eslint": "^8.56.0",
    "@typescript-eslint/eslint-plugin": "^6.19.0",
    "prettier": "^3.2.0"
  }
}
```

### vite.config.ts

```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
      '@components': path.resolve(__dirname, './src/components'),
      '@hooks': path.resolve(__dirname, './src/hooks'),
      '@services': path.resolve(__dirname, './src/services'),
      '@types': path.resolve(__dirname, './src/types'),
    },
  },
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true,
      },
    },
  },
  build: {
    outDir: 'dist',
    sourcemap: true,
  },
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./src/test/setup.ts'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'html'],
      exclude: ['node_modules/', 'src/test/'],
    },
  },
});
```

### tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@components/*": ["src/components/*"],
      "@hooks/*": ["src/hooks/*"],
      "@services/*": ["src/services/*"],
      "@types/*": ["src/types/*"]
    }
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

### Types (src/types/index.ts)

```typescript
// src/types/index.ts
export interface Coordenadas {
  latitude: number;
  longitude: number;
}

export type FaixaDuracao =
  | 'ATE_1H'
  | 'DE_1_A_3H'
  | 'DE_3_A_6H'
  | 'DE_6_A_12H'
  | 'DE_12_A_24H'
  | 'DE_24_A_48H'
  | 'MAIS_48H';

export type StatusOcorrencia =
  | 'EM_PREPARACAO'
  | 'DESLOCAMENTO'
  | 'EM_EXECUCAO'
  | 'CONCLUIDA';

export type TipoInterrupcao = 'PROGRAMADA' | 'NAO_PROGRAMADA';

export interface InterrupcaoMapa {
  id: string;
  numeroOcorrencia: string;
  codigoIbge: string;
  nomeMunicipio: string;
  bairro: string;
  coordenadas: Coordenadas;
  dataHora: string;
  dataInicio: string;
  tipo: TipoInterrupcao;
  faixaDuracao: FaixaDuracao;
  faixaDuracaoLabel: string;
  corFaixa: string;
  causa: string | null;
  causaConhecida: boolean;
  status: StatusOcorrencia;
  statusLabel: string;
  statusCor: string;
  statusIcone: string;
  ucsAfetadas: number;
  chi: number;
  previsaoRestabelecimento: string | null;
  equipesDesignadas: number;
}

export interface EstatisticasMapa {
  totalInterrupcoes: number;
  totalUcsAfetadas: number;
  chiTotal: number;
  equipesEmCampo: number;
  porFaixa: FaixaEstatistica[];
  porMunicipio: MunicipioEstatistica[];
  ultimaAtualizacao: string;
}

export interface FaixaEstatistica {
  faixa: FaixaDuracao;
  label: string;
  cor: string;
  quantidade: number;
  percentual: number;
  ucsAfetadas: number;
}

export interface MunicipioEstatistica {
  codigoIbge: string;
  nome: string;
  quantidade: number;
  percentual: number;
  ucsAfetadas: number;
}

export interface ApiResponse<T> {
  success: boolean;
  data: T;
  estatisticas?: EstatisticasMapa;
  fromCache: boolean;
}
```

### API Service (src/services/api.ts)

```typescript
// src/services/api.ts
import axios from 'axios';
import type { InterrupcaoMapa, EstatisticasMapa, ApiResponse } from '@/types';

const api = axios.create({
  baseURL: '/api/mapa',
  timeout: 10000,
});

export const mapaService = {
  async getInterrupcoes(params?: {
    municipio?: string;
    faixa?: string;
  }): Promise<ApiResponse<InterrupcaoMapa[]>> {
    const response = await api.get<ApiResponse<InterrupcaoMapa[]>>(
      '/interrupcoes',
      { params }
    );
    return response.data;
  },

  async getEstatisticas(): Promise<ApiResponse<EstatisticasMapa>> {
    const response = await api.get<ApiResponse<EstatisticasMapa>>(
      '/estatisticas'
    );
    return response.data;
  },

  async getMunicipiosGeojson(): Promise<GeoJSON.FeatureCollection> {
    const response = await api.get('/municipios/geojson');
    return response.data;
  },
};
```

### App.tsx

```typescript
// src/App.tsx
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { MapaRoraima } from '@/components/MapaRoraima';
import { PainelEstatisticas } from '@/components/PainelEstatisticas';
import './styles/global.css';

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 30 * 60 * 1000, // 30 minutos (REN 1.137)
      refetchInterval: 30 * 60 * 1000,
    },
  },
});

export function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <div className="min-h-screen bg-gray-100">
        <header className="bg-blue-800 text-white p-4">
          <h1 className="text-2xl font-bold">
            Portal de Interrupcoes - Roraima Energia
          </h1>
          <p className="text-sm opacity-80">
            Atualizado a cada 30 minutos (REN 1.137/2025)
          </p>
        </header>

        <main className="container mx-auto p-4">
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-4">
            <div className="lg:col-span-2">
              <MapaRoraima />
            </div>
            <div>
              <PainelEstatisticas />
            </div>
          </div>
        </main>

        <footer className="bg-gray-800 text-white p-4 text-center">
          <p>© 2025 Roraima Energia - Conforme REN 1.137/2025 ANEEL</p>
        </footer>
      </div>
    </QueryClientProvider>
  );
}
```

## Testes

```typescript
// src/test/setup.ts
import '@testing-library/jest-dom';
import { vi } from 'vitest';

// Mock Leaflet
vi.mock('leaflet', () => ({
  map: vi.fn(),
  tileLayer: vi.fn(),
  marker: vi.fn(),
}));


// src/App.test.tsx
import { render, screen } from '@testing-library/react';
import { describe, it, expect } from 'vitest';
import { App } from './App';

describe('App', () => {
  it('deve renderizar titulo', () => {
    render(<App />);

    expect(
      screen.getByText(/Portal de Interrupcoes/i)
    ).toBeInTheDocument();
  });

  it('deve mencionar REN 1.137/2025', () => {
    render(<App />);

    expect(
      screen.getByText(/REN 1.137\/2025/i)
    ).toBeInTheDocument();
  });
});
```

## Criterios de Aceite

- [ ] Projeto criado com Vite
- [ ] TypeScript configurado
- [ ] React 18 instalado
- [ ] Leaflet e react-leaflet instalados
- [ ] TanStack Query configurado
- [ ] Tailwind CSS configurado
- [ ] Vitest configurado
- [ ] Aliases de import funcionando
- [ ] Proxy para API configurado
- [ ] Build funcional

## Comando de Execucao

```bash
# Criar projeto (se nao existir)
cd frontend
npm create vite@latest . -- --template react-ts

# Instalar dependencias
npm install

# Desenvolvimento
npm run dev

# Build
npm run build

# Testes
npm test

# Preview
npm run preview
```
