# RAD-227: Testes Acessibilidade (WCAG)

**Fase:** 6 - Testes
**Tipo:** Accessibility Tests
**Prioridade:** Media
**Status:** PENDENTE
**Dependencias:** RAD-216 a RAD-222

## Objetivo

Garantir que o portal atende criterios de acessibilidade WCAG 2.1 AA.

## Localizacao

`frontend/tests/a11y/`

## Criterios WCAG 2.1 AA

| Criterio | Descricao | Status |
|----------|-----------|--------|
| 1.1.1 | Texto alternativo | - |
| 1.3.1 | Informacao e relacoes | - |
| 1.4.3 | Contraste minimo | - |
| 2.1.1 | Teclado | - |
| 2.4.1 | Ignorar blocos | - |
| 2.4.2 | Titulo da pagina | - |
| 4.1.2 | Nome, funcao, valor | - |

## Implementacao

```typescript
// tests/a11y/accessibility.spec.ts
import { test, expect } from '@playwright/test';
import AxeBuilder from '@axe-core/playwright';

test.describe('Acessibilidade WCAG 2.1 AA', () => {
  test('pagina inicial sem violacoes criticas', async ({ page }) => {
    await page.goto('/');

    const accessibilityScanResults = await new AxeBuilder({ page })
      .withTags(['wcag2a', 'wcag2aa'])
      .analyze();

    expect(accessibilityScanResults.violations).toEqual([]);
  });

  test('painel de estatisticas acessivel', async ({ page }) => {
    await page.goto('/');

    const accessibilityScanResults = await new AxeBuilder({ page })
      .include('.painel-estatisticas')
      .analyze();

    expect(accessibilityScanResults.violations).toEqual([]);
  });

  test('navegacao por teclado funciona', async ({ page }) => {
    await page.goto('/');

    // Tab para o primeiro elemento interativo
    await page.keyboard.press('Tab');

    // Verificar que foco esta visivel
    const focusedElement = await page.evaluate(() => {
      return document.activeElement?.tagName;
    });

    expect(focusedElement).toBeTruthy();
  });

  test('contraste de cores adequado', async ({ page }) => {
    await page.goto('/');

    const accessibilityScanResults = await new AxeBuilder({ page })
      .withTags(['wcag2aa'])
      .options({ rules: { 'color-contrast': { enabled: true } } })
      .analyze();

    const contrastViolations = accessibilityScanResults.violations
      .filter(v => v.id === 'color-contrast');

    expect(contrastViolations).toEqual([]);
  });

  test('imagens tem texto alternativo', async ({ page }) => {
    await page.goto('/');

    const images = await page.locator('img').all();

    for (const img of images) {
      const alt = await img.getAttribute('alt');
      expect(alt).toBeTruthy();
    }
  });

  test('formularios tem labels', async ({ page }) => {
    await page.goto('/');

    const inputs = await page.locator('input').all();

    for (const input of inputs) {
      const id = await input.getAttribute('id');
      const ariaLabel = await input.getAttribute('aria-label');
      const ariaLabelledby = await input.getAttribute('aria-labelledby');

      const hasLabel = id
        ? await page.locator(`label[for="${id}"]`).count() > 0
        : false;

      expect(hasLabel || ariaLabel || ariaLabelledby).toBeTruthy();
    }
  });

  test('botoes tem texto acessivel', async ({ page }) => {
    await page.goto('/');

    const buttons = await page.locator('button').all();

    for (const button of buttons) {
      const text = await button.textContent();
      const ariaLabel = await button.getAttribute('aria-label');

      expect(text?.trim() || ariaLabel).toBeTruthy();
    }
  });

  test('landmarks ARIA presentes', async ({ page }) => {
    await page.goto('/');

    await expect(page.locator('header, [role="banner"]')).toBeVisible();
    await expect(page.locator('main, [role="main"]')).toBeVisible();
    await expect(page.locator('footer, [role="contentinfo"]')).toBeVisible();
  });

  test('skip link funciona', async ({ page }) => {
    await page.goto('/');

    // Pressionar Tab para revelar skip link
    await page.keyboard.press('Tab');

    const skipLink = page.locator('a[href="#main-content"]');

    if (await skipLink.isVisible()) {
      await skipLink.click();

      // Verificar que foco moveu para conteudo principal
      const focusedId = await page.evaluate(() => {
        return document.activeElement?.id;
      });

      expect(focusedId).toBe('main-content');
    }
  });

  test('mapa tem alternativa textual', async ({ page }) => {
    await page.goto('/');

    // O mapa deve ter uma descricao acessivel
    const mapa = page.locator('.leaflet-container');
    const ariaLabel = await mapa.getAttribute('aria-label');
    const role = await mapa.getAttribute('role');

    expect(ariaLabel || role).toBeTruthy();
  });
});
```

### Implementacao de Melhorias de Acessibilidade

```typescript
// src/components/MapaRoraima/MapaRoraima.tsx - Melhorias de a11y
<MapContainer
  center={CENTRO_RORAIMA}
  zoom={ZOOM_INICIAL}
  className="h-[600px] rounded-lg shadow-lg"
  aria-label="Mapa de interrupcoes de energia em Roraima"
  role="application"
>
  {/* ... */}
</MapContainer>

// Skip link
<a
  href="#main-content"
  className="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:bg-white focus:p-2 focus:z-50"
>
  Pular para conteudo principal
</a>

// Tabela de estatisticas acessivel
<table aria-label="Estatisticas de interrupcoes por faixa de duracao">
  <caption className="sr-only">
    Distribuicao de interrupcoes por faixa de duracao
  </caption>
  {/* ... */}
</table>
```

## Criterios de Aceite

- [ ] Scan axe-core sem violacoes criticas
- [ ] Navegacao por teclado funcional
- [ ] Contraste adequado (4.5:1)
- [ ] Landmarks ARIA presentes
- [ ] Skip link implementado
- [ ] Textos alternativos em imagens
- [ ] Labels em formularios
- [ ] Testes passando

## Comando de Execucao

```bash
# Instalar axe-core
npm install -D @axe-core/playwright

# Executar testes de acessibilidade
npx playwright test tests/a11y/

# Gerar relatorio
npx playwright test tests/a11y/ --reporter=html
```
