# RAD-200: Value Object FaixaDuracao

**Fase:** 1 - Domain Layer
**Tipo:** Domain
**Prioridade:** Alta
**Status:** PENDENTE
**Dependencias:** -
**Base Legal:** REN 1.137/2025 - Art. 107 alinea "d"

## Objetivo

Criar Value Object para classificar interrupcoes por faixa de duracao conforme REN 1.137/2025.

## Localizacao

`backend/shared/domain/value_objects/faixa_duracao.py`

## Especificacao

### Faixas de Duracao (REN 1.137 Art. 107)

| Faixa | Descricao | Minutos Min | Minutos Max |
|-------|-----------|-------------|-------------|
| `ATE_1H` | Menos de 1 hora | 0 | 59 |
| `DE_1_A_3H` | De 1 a 3 horas | 60 | 179 |
| `DE_3_A_6H` | De 3 a 6 horas | 180 | 359 |
| `DE_6_A_12H` | De 6 a 12 horas | 360 | 719 |
| `DE_12_A_24H` | De 12 a 24 horas | 720 | 1439 |
| `DE_24_A_48H` | De 24 a 48 horas | 1440 | 2879 |
| `MAIS_48H` | Mais de 48 horas | 2880 | - |

### Funcionalidades

1. **from_minutos(minutos):** Determina faixa a partir da duracao
2. **get_cor():** Retorna cor para renderizacao no mapa
3. **get_severidade():** Retorna nivel de severidade (1-7)

## Implementacao

```python
# shared/domain/value_objects/faixa_duracao.py
from enum import Enum
from dataclasses import dataclass


class FaixaDuracao(Enum):
    """Value Object para classificacao de duracao de interrupcao."""

    ATE_1H = "ATE_1H"
    DE_1_A_3H = "DE_1_A_3H"
    DE_3_A_6H = "DE_3_A_6H"
    DE_6_A_12H = "DE_6_A_12H"
    DE_12_A_24H = "DE_12_A_24H"
    DE_24_A_48H = "DE_24_A_48H"
    MAIS_48H = "MAIS_48H"

    @classmethod
    def from_minutos(cls, minutos: int) -> "FaixaDuracao":
        """
        Determina faixa de duracao a partir de minutos.

        Args:
            minutos: Duracao em minutos

        Returns:
            FaixaDuracao correspondente
        """
        if minutos < 0:
            raise ValueError("Duracao nao pode ser negativa")

        if minutos < 60:
            return cls.ATE_1H
        elif minutos < 180:
            return cls.DE_1_A_3H
        elif minutos < 360:
            return cls.DE_3_A_6H
        elif minutos < 720:
            return cls.DE_6_A_12H
        elif minutos < 1440:
            return cls.DE_12_A_24H
        elif minutos < 2880:
            return cls.DE_24_A_48H
        else:
            return cls.MAIS_48H

    @classmethod
    def from_horas(cls, horas: float) -> "FaixaDuracao":
        """Determina faixa a partir de horas."""
        return cls.from_minutos(int(horas * 60))

    def get_cor(self) -> str:
        """
        Retorna cor hexadecimal para visualizacao no mapa.

        Returns:
            Cor hexadecimal (do verde ao vermelho escuro)
        """
        cores = {
            FaixaDuracao.ATE_1H: "#4CAF50",       # Verde
            FaixaDuracao.DE_1_A_3H: "#8BC34A",    # Verde claro
            FaixaDuracao.DE_3_A_6H: "#FFEB3B",    # Amarelo
            FaixaDuracao.DE_6_A_12H: "#FF9800",   # Laranja
            FaixaDuracao.DE_12_A_24H: "#FF5722",  # Laranja escuro
            FaixaDuracao.DE_24_A_48H: "#F44336",  # Vermelho
            FaixaDuracao.MAIS_48H: "#B71C1C",     # Vermelho escuro
        }
        return cores[self]

    def get_severidade(self) -> int:
        """
        Retorna nivel de severidade (1 a 7).

        Returns:
            Nivel de severidade para ordenacao
        """
        severidades = {
            FaixaDuracao.ATE_1H: 1,
            FaixaDuracao.DE_1_A_3H: 2,
            FaixaDuracao.DE_3_A_6H: 3,
            FaixaDuracao.DE_6_A_12H: 4,
            FaixaDuracao.DE_12_A_24H: 5,
            FaixaDuracao.DE_24_A_48H: 6,
            FaixaDuracao.MAIS_48H: 7,
        }
        return severidades[self]

    def get_label(self) -> str:
        """Retorna label para exibicao ao usuario."""
        labels = {
            FaixaDuracao.ATE_1H: "Menos de 1 hora",
            FaixaDuracao.DE_1_A_3H: "1 a 3 horas",
            FaixaDuracao.DE_3_A_6H: "3 a 6 horas",
            FaixaDuracao.DE_6_A_12H: "6 a 12 horas",
            FaixaDuracao.DE_12_A_24H: "12 a 24 horas",
            FaixaDuracao.DE_24_A_48H: "24 a 48 horas",
            FaixaDuracao.MAIS_48H: "Mais de 48 horas",
        }
        return labels[self]
```

## Testes TDD (Escrever PRIMEIRO)

```python
# tests/unit/domain/value_objects/test_faixa_duracao.py
import pytest
from shared.domain.value_objects.faixa_duracao import FaixaDuracao


class TestFaixaDuracao:
    """Testes para Value Object FaixaDuracao."""

    class TestFromMinutos:
        """Testes para factory from_minutos()."""

        @pytest.mark.parametrize("minutos,esperado", [
            (0, FaixaDuracao.ATE_1H),
            (30, FaixaDuracao.ATE_1H),
            (59, FaixaDuracao.ATE_1H),
            (60, FaixaDuracao.DE_1_A_3H),
            (120, FaixaDuracao.DE_1_A_3H),
            (179, FaixaDuracao.DE_1_A_3H),
            (180, FaixaDuracao.DE_3_A_6H),
            (359, FaixaDuracao.DE_3_A_6H),
            (360, FaixaDuracao.DE_6_A_12H),
            (719, FaixaDuracao.DE_6_A_12H),
            (720, FaixaDuracao.DE_12_A_24H),
            (1439, FaixaDuracao.DE_12_A_24H),
            (1440, FaixaDuracao.DE_24_A_48H),
            (2879, FaixaDuracao.DE_24_A_48H),
            (2880, FaixaDuracao.MAIS_48H),
            (10000, FaixaDuracao.MAIS_48H),
        ])
        def test_deve_classificar_corretamente(self, minutos, esperado):
            """Testa classificacao de minutos em faixas."""
            assert FaixaDuracao.from_minutos(minutos) == esperado

        def test_deve_rejeitar_minutos_negativos(self):
            """Minutos negativos devem lancar excecao."""
            with pytest.raises(ValueError, match="negativa"):
                FaixaDuracao.from_minutos(-1)

    class TestFromHoras:
        """Testes para factory from_horas()."""

        @pytest.mark.parametrize("horas,esperado", [
            (0.5, FaixaDuracao.ATE_1H),
            (1.0, FaixaDuracao.DE_1_A_3H),
            (2.5, FaixaDuracao.DE_1_A_3H),
            (3.0, FaixaDuracao.DE_3_A_6H),
            (6.0, FaixaDuracao.DE_6_A_12H),
            (12.0, FaixaDuracao.DE_12_A_24H),
            (24.0, FaixaDuracao.DE_24_A_48H),
            (48.0, FaixaDuracao.MAIS_48H),
        ])
        def test_deve_converter_horas_para_faixa(self, horas, esperado):
            """Testa conversao de horas para faixa."""
            assert FaixaDuracao.from_horas(horas) == esperado

    class TestGetCor:
        """Testes para metodo get_cor()."""

        def test_deve_retornar_verde_para_ate_1h(self):
            """Faixa ATE_1H deve ter cor verde."""
            assert FaixaDuracao.ATE_1H.get_cor() == "#4CAF50"

        def test_deve_retornar_vermelho_escuro_para_mais_48h(self):
            """Faixa MAIS_48H deve ter cor vermelha escura."""
            assert FaixaDuracao.MAIS_48H.get_cor() == "#B71C1C"

        def test_todas_faixas_devem_ter_cor(self):
            """Todas as faixas devem ter cor definida."""
            for faixa in FaixaDuracao:
                assert faixa.get_cor().startswith("#")
                assert len(faixa.get_cor()) == 7

    class TestGetSeveridade:
        """Testes para metodo get_severidade()."""

        def test_severidade_cresce_com_duracao(self):
            """Severidade deve crescer conforme duracao aumenta."""
            faixas = list(FaixaDuracao)
            for i in range(len(faixas) - 1):
                assert faixas[i].get_severidade() < faixas[i + 1].get_severidade()

        def test_severidade_entre_1_e_7(self):
            """Severidade deve estar entre 1 e 7."""
            for faixa in FaixaDuracao:
                assert 1 <= faixa.get_severidade() <= 7

    class TestGetLabel:
        """Testes para metodo get_label()."""

        def test_todas_faixas_devem_ter_label(self):
            """Todas as faixas devem ter label."""
            for faixa in FaixaDuracao:
                assert len(faixa.get_label()) > 0
```

## Criterios de Aceite

- [ ] Testes escritos e passando
- [ ] Enum com 7 faixas conforme REN 1.137
- [ ] Factory from_minutos() funcional
- [ ] Factory from_horas() funcional
- [ ] Cores para visualizacao no mapa
- [ ] Severidade para ordenacao
- [ ] Labels para exibicao
- [ ] Cobertura >= 90%

## Comando de Execucao

```bash
# Executar testes (RED)
pytest tests/unit/domain/value_objects/test_faixa_duracao.py -v

# Com cobertura
pytest tests/unit/domain/value_objects/test_faixa_duracao.py --cov=shared/domain/value_objects/faixa_duracao --cov-report=term-missing
```
