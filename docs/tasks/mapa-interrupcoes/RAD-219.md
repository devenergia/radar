# RAD-219: Componente ListaInterrupcoes

**Fase:** 5 - Frontend
**Tipo:** React Component
**Prioridade:** Media
**Status:** PENDENTE
**Dependencias:** RAD-216, RAD-213

## Objetivo

Criar componente de lista ordenavel e filtravel das interrupcoes.

## Localizacao

`frontend/src/components/ListaInterrupcoes/ListaInterrupcoes.tsx`

## Implementacao

```typescript
// src/components/ListaInterrupcoes/ListaInterrupcoes.tsx
import { useState, useMemo } from 'react';
import { useQuery } from '@tanstack/react-query';
import { mapaService } from '@/services/api';
import type { InterrupcaoMapa, FaixaDuracao } from '@/types';
import { formatDistanceToNow } from 'date-fns';
import { ptBR } from 'date-fns/locale';

type SortKey = 'duracao' | 'ucs' | 'chi' | 'municipio';
type SortDir = 'asc' | 'desc';

interface ListaInterrupcoesProps {
  onItemClick?: (interrupcao: InterrupcaoMapa) => void;
}

export function ListaInterrupcoes({ onItemClick }: ListaInterrupcoesProps) {
  const [sortKey, setSortKey] = useState<SortKey>('duracao');
  const [sortDir, setSortDir] = useState<SortDir>('desc');
  const [filtroMunicipio, setFiltroMunicipio] = useState<string>('');

  const { data: response, isLoading } = useQuery({
    queryKey: ['interrupcoes'],
    queryFn: () => mapaService.getInterrupcoes(),
  });

  const interrupcoes = response?.data ?? [];

  // Filtrar e ordenar
  const listaOrdenada = useMemo(() => {
    let lista = [...interrupcoes];

    // Filtrar por municipio
    if (filtroMunicipio) {
      lista = lista.filter((i) =>
        i.nomeMunicipio.toLowerCase().includes(filtroMunicipio.toLowerCase())
      );
    }

    // Ordenar
    lista.sort((a, b) => {
      let cmp = 0;
      switch (sortKey) {
        case 'duracao':
          cmp = getSeveridade(a.faixaDuracao) - getSeveridade(b.faixaDuracao);
          break;
        case 'ucs':
          cmp = a.ucsAfetadas - b.ucsAfetadas;
          break;
        case 'chi':
          cmp = a.chi - b.chi;
          break;
        case 'municipio':
          cmp = a.nomeMunicipio.localeCompare(b.nomeMunicipio);
          break;
      }
      return sortDir === 'asc' ? cmp : -cmp;
    });

    return lista;
  }, [interrupcoes, sortKey, sortDir, filtroMunicipio]);

  const handleSort = (key: SortKey) => {
    if (sortKey === key) {
      setSortDir(sortDir === 'asc' ? 'desc' : 'asc');
    } else {
      setSortKey(key);
      setSortDir('desc');
    }
  };

  if (isLoading) {
    return <div className="animate-pulse">Carregando...</div>;
  }

  return (
    <div className="bg-white rounded-lg shadow-lg overflow-hidden">
      {/* Header com filtro */}
      <div className="p-4 border-b">
        <input
          type="text"
          placeholder="Filtrar por municipio..."
          className="w-full px-3 py-2 border rounded-lg"
          value={filtroMunicipio}
          onChange={(e) => setFiltroMunicipio(e.target.value)}
        />
      </div>

      {/* Cabecalho da tabela */}
      <div className="grid grid-cols-5 gap-2 p-3 bg-gray-100 text-sm font-semibold">
        <SortHeader
          label="Municipio"
          sortKey="municipio"
          current={sortKey}
          dir={sortDir}
          onClick={handleSort}
        />
        <SortHeader
          label="Duracao"
          sortKey="duracao"
          current={sortKey}
          dir={sortDir}
          onClick={handleSort}
        />
        <SortHeader
          label="UCs"
          sortKey="ucs"
          current={sortKey}
          dir={sortDir}
          onClick={handleSort}
        />
        <SortHeader
          label="CHI"
          sortKey="chi"
          current={sortKey}
          dir={sortDir}
          onClick={handleSort}
        />
        <div>Status</div>
      </div>

      {/* Lista de interrupcoes */}
      <div className="max-h-[400px] overflow-y-auto">
        {listaOrdenada.length === 0 ? (
          <div className="p-4 text-center text-gray-500">
            Nenhuma interrupcao encontrada
          </div>
        ) : (
          listaOrdenada.map((item) => (
            <div
              key={item.id}
              className="grid grid-cols-5 gap-2 p-3 border-b hover:bg-gray-50 cursor-pointer text-sm"
              onClick={() => onItemClick?.(item)}
            >
              <div>
                <div className="font-medium">{item.nomeMunicipio}</div>
                <div className="text-xs text-gray-500">{item.bairro}</div>
              </div>
              <div>
                <span
                  className="px-2 py-1 rounded text-xs font-medium"
                  style={{
                    backgroundColor: item.corFaixa + '20',
                    color: item.corFaixa,
                  }}
                >
                  {item.faixaDuracaoLabel}
                </span>
              </div>
              <div>{item.ucsAfetadas.toLocaleString('pt-BR')}</div>
              <div>{item.chi.toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</div>
              <div>
                <span
                  className="px-2 py-1 rounded text-xs"
                  style={{
                    backgroundColor: item.statusCor + '20',
                    color: item.statusCor,
                  }}
                >
                  {item.statusLabel}
                </span>
              </div>
            </div>
          ))
        )}
      </div>

      {/* Footer com contagem */}
      <div className="p-3 bg-gray-50 text-sm text-gray-600">
        {listaOrdenada.length} de {interrupcoes.length} interrupcoes
      </div>
    </div>
  );
}

function SortHeader({
  label,
  sortKey,
  current,
  dir,
  onClick,
}: {
  label: string;
  sortKey: SortKey;
  current: SortKey;
  dir: SortDir;
  onClick: (key: SortKey) => void;
}) {
  const isActive = current === sortKey;

  return (
    <button
      className="flex items-center gap-1 hover:text-blue-600"
      onClick={() => onClick(sortKey)}
    >
      {label}
      {isActive && <span>{dir === 'asc' ? '↑' : '↓'}</span>}
    </button>
  );
}

function getSeveridade(faixa: FaixaDuracao): number {
  const map: Record<FaixaDuracao, number> = {
    ATE_1H: 1,
    DE_1_A_3H: 2,
    DE_3_A_6H: 3,
    DE_6_A_12H: 4,
    DE_12_A_24H: 5,
    DE_24_A_48H: 6,
    MAIS_48H: 7,
  };
  return map[faixa];
}
```

## Criterios de Aceite

- [ ] Lista de interrupcoes renderiza
- [ ] Ordenacao por colunas funcional
- [ ] Filtro por municipio funcional
- [ ] Click abre detalhes
- [ ] Responsivo
- [ ] Testes passando
