# RAD-226: Testes E2E - Frontend

**Fase:** 6 - Testes
**Tipo:** E2E Tests
**Prioridade:** Alta
**Status:** PENDENTE
**Dependencias:** RAD-216 a RAD-222

## Objetivo

Criar testes end-to-end para frontend com Playwright.

## Localizacao

`frontend/tests/e2e/`

## Implementacao

```typescript
// tests/e2e/mapa.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Mapa de Interrupcoes', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/');
  });

  test('deve carregar a pagina inicial', async ({ page }) => {
    await expect(page).toHaveTitle(/Portal de Interrupcoes/);
  });

  test('deve mostrar o mapa', async ({ page }) => {
    const mapa = page.locator('.leaflet-container');
    await expect(mapa).toBeVisible();
  });

  test('deve mostrar painel de estatisticas', async ({ page }) => {
    await expect(page.getByText('Estatisticas')).toBeVisible();
  });

  test('deve mostrar total de interrupcoes', async ({ page }) => {
    await expect(page.getByText('Interrupcoes')).toBeVisible();
  });

  test('deve mostrar legenda', async ({ page }) => {
    await expect(page.getByText('Faixa de Duracao')).toBeVisible();
  });

  test('deve mostrar marcadores no mapa', async ({ page }) => {
    // Aguardar dados carregarem
    await page.waitForResponse('**/api/mapa/interrupcoes');

    const markers = page.locator('.custom-marker');
    // Pode ter 0 ou mais marcadores
    await expect(markers.first()).toBeVisible({ timeout: 5000 }).catch(() => {
      // OK se nao houver interrupcoes
    });
  });

  test('deve abrir popup ao clicar no marcador', async ({ page }) => {
    await page.waitForResponse('**/api/mapa/interrupcoes');

    const marker = page.locator('.custom-marker').first();
    if (await marker.isVisible()) {
      await marker.click();
      await expect(page.locator('.leaflet-popup')).toBeVisible();
    }
  });

  test('deve filtrar por municipio', async ({ page }) => {
    const input = page.getByPlaceholder('Filtrar por municipio');
    await input.fill('Boa Vista');

    // Verificar que filtro foi aplicado
    await expect(input).toHaveValue('Boa Vista');
  });

  test('deve ser responsivo em mobile', async ({ page }) => {
    await page.setViewportSize({ width: 375, height: 667 });

    // Mapa ainda deve estar visivel
    await expect(page.locator('.leaflet-container')).toBeVisible();

    // Botao de lista deve aparecer
    await expect(page.getByText('Ver Lista')).toBeVisible();
  });

  test('deve mostrar timestamp de atualizacao', async ({ page }) => {
    await expect(page.getByText(/Atualizado/)).toBeVisible();
  });
});

test.describe('Acessibilidade', () => {
  test('deve ter titulo da pagina', async ({ page }) => {
    await page.goto('/');
    await expect(page).toHaveTitle(/.+/);
  });

  test('deve ter landmarks ARIA', async ({ page }) => {
    await page.goto('/');

    await expect(page.locator('header')).toBeVisible();
    await expect(page.locator('main')).toBeVisible();
    await expect(page.locator('footer')).toBeVisible();
  });
});
```

### playwright.config.ts

```typescript
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './tests/e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'Mobile Chrome',
      use: { ...devices['Pixel 5'] },
    },
  ],
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
  },
});
```

## Criterios de Aceite

- [ ] Testes de carregamento
- [ ] Testes de interacao com mapa
- [ ] Testes de filtros
- [ ] Testes de responsividade
- [ ] Testes de acessibilidade basica
- [ ] Todos os testes passando

## Comando de Execucao

```bash
# Instalar Playwright
npm install -D @playwright/test
npx playwright install

# Executar testes
npx playwright test

# Com UI
npx playwright test --ui

# Modo debug
npx playwright test --debug
```
