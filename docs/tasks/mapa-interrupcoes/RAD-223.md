# RAD-223: Testes Unit - Value Objects

**Fase:** 6 - Testes
**Tipo:** Unit Tests
**Prioridade:** Critica
**Status:** PENDENTE
**Dependencias:** RAD-200, RAD-201, RAD-202
**Meta:** Cobertura >= 80%

## Objetivo

Criar testes unitarios completos para Value Objects do mapa.

## Localizacao

```
backend/tests/unit/domain/value_objects/
├── test_faixa_duracao.py
├── test_status_ocorrencia.py
└── test_coordenadas.py
```

## Testes a Implementar

### FaixaDuracao

```python
# tests/unit/domain/value_objects/test_faixa_duracao.py
import pytest
from shared.domain.value_objects.faixa_duracao import FaixaDuracao


class TestFaixaDuracao:
    """Testes para Value Object FaixaDuracao."""

    class TestFromMinutos:
        @pytest.mark.parametrize("minutos,esperado", [
            (0, FaixaDuracao.ATE_1H),
            (59, FaixaDuracao.ATE_1H),
            (60, FaixaDuracao.DE_1_A_3H),
            (179, FaixaDuracao.DE_1_A_3H),
            (180, FaixaDuracao.DE_3_A_6H),
            (359, FaixaDuracao.DE_3_A_6H),
            (360, FaixaDuracao.DE_6_A_12H),
            (719, FaixaDuracao.DE_6_A_12H),
            (720, FaixaDuracao.DE_12_A_24H),
            (1439, FaixaDuracao.DE_12_A_24H),
            (1440, FaixaDuracao.DE_24_A_48H),
            (2879, FaixaDuracao.DE_24_A_48H),
            (2880, FaixaDuracao.MAIS_48H),
            (10000, FaixaDuracao.MAIS_48H),
        ])
        def test_classificacao_correta(self, minutos, esperado):
            assert FaixaDuracao.from_minutos(minutos) == esperado

        def test_rejeita_minutos_negativos(self):
            with pytest.raises(ValueError):
                FaixaDuracao.from_minutos(-1)

    class TestFromHoras:
        @pytest.mark.parametrize("horas,esperado", [
            (0.5, FaixaDuracao.ATE_1H),
            (1.5, FaixaDuracao.DE_1_A_3H),
            (4.0, FaixaDuracao.DE_3_A_6H),
            (8.0, FaixaDuracao.DE_6_A_12H),
            (18.0, FaixaDuracao.DE_12_A_24H),
            (36.0, FaixaDuracao.DE_24_A_48H),
            (72.0, FaixaDuracao.MAIS_48H),
        ])
        def test_conversao_horas(self, horas, esperado):
            assert FaixaDuracao.from_horas(horas) == esperado

    class TestGetCor:
        def test_todas_faixas_tem_cor(self):
            for faixa in FaixaDuracao:
                cor = faixa.get_cor()
                assert cor.startswith("#")
                assert len(cor) == 7

        def test_cor_verde_para_menor_duracao(self):
            assert "#4CAF50" == FaixaDuracao.ATE_1H.get_cor()

        def test_cor_vermelha_para_maior_duracao(self):
            assert "#B71C1C" == FaixaDuracao.MAIS_48H.get_cor()

    class TestGetSeveridade:
        def test_severidade_crescente(self):
            faixas = list(FaixaDuracao)
            for i in range(len(faixas) - 1):
                assert faixas[i].get_severidade() < faixas[i + 1].get_severidade()

    class TestGetLabel:
        def test_todas_faixas_tem_label(self):
            for faixa in FaixaDuracao:
                assert len(faixa.get_label()) > 0
```

### StatusOcorrencia

```python
# tests/unit/domain/value_objects/test_status_ocorrencia.py
import pytest
from shared.domain.value_objects.status_ocorrencia import StatusOcorrencia


class TestStatusOcorrencia:
    """Testes para Value Object StatusOcorrencia."""

    class TestFromCodigo:
        @pytest.mark.parametrize("codigo,esperado", [
            ("P", StatusOcorrencia.EM_PREPARACAO),
            ("D", StatusOcorrencia.DESLOCAMENTO),
            ("E", StatusOcorrencia.EM_EXECUCAO),
            ("C", StatusOcorrencia.CONCLUIDA),
            (None, StatusOcorrencia.EM_PREPARACAO),
            ("X", StatusOcorrencia.EM_PREPARACAO),  # desconhecido
        ])
        def test_mapeamento(self, codigo, esperado):
            assert StatusOcorrencia.from_codigo(codigo) == esperado

    class TestIsAtiva:
        @pytest.mark.parametrize("status,esperado", [
            (StatusOcorrencia.EM_PREPARACAO, True),
            (StatusOcorrencia.DESLOCAMENTO, True),
            (StatusOcorrencia.EM_EXECUCAO, True),
            (StatusOcorrencia.CONCLUIDA, False),
        ])
        def test_status_ativo(self, status, esperado):
            assert status.is_ativa() == esperado

    class TestMetodos:
        def test_todas_tem_cor(self):
            for status in StatusOcorrencia:
                assert status.get_cor().startswith("#")

        def test_todas_tem_icone(self):
            for status in StatusOcorrencia:
                assert len(status.get_icone()) > 0

        def test_todas_tem_label(self):
            for status in StatusOcorrencia:
                assert len(status.get_label()) > 0

        def test_ordem_sequencial(self):
            assert StatusOcorrencia.EM_PREPARACAO.get_ordem() == 1
            assert StatusOcorrencia.DESLOCAMENTO.get_ordem() == 2
            assert StatusOcorrencia.EM_EXECUCAO.get_ordem() == 3
            assert StatusOcorrencia.CONCLUIDA.get_ordem() == 4
```

### Coordenadas

```python
# tests/unit/domain/value_objects/test_coordenadas.py
import pytest
from shared.domain.value_objects.coordenadas import Coordenadas, CoordenadasRoraima


class TestCoordenadas:
    """Testes para Value Object Coordenadas."""

    class TestCreate:
        def test_criar_validas(self):
            result = Coordenadas.create(2.823841, -60.675833)
            assert result.is_success

        def test_rejeitar_latitude_invalida(self):
            result = Coordenadas.create(91.0, -60.0)
            assert result.is_failure

        def test_rejeitar_longitude_invalida(self):
            result = Coordenadas.create(2.0, 181.0)
            assert result.is_failure

        def test_validar_roraima(self):
            # Sao Paulo
            result = Coordenadas.create(-23.5, -46.6, validate_roraima=True)
            assert result.is_failure

            # Boa Vista
            result = Coordenadas.create(2.823841, -60.675833, validate_roraima=True)
            assert result.is_success

    class TestIsInRoraima:
        def test_boa_vista_em_roraima(self):
            coords = Coordenadas.create(2.823841, -60.675833).value
            assert coords.is_in_roraima() is True

        def test_sao_paulo_fora_roraima(self):
            coords = Coordenadas.create(-23.5, -46.6).value
            assert coords.is_in_roraima() is False

    class TestDistanceTo:
        def test_mesma_coordenada_zero(self):
            coords = Coordenadas.create(2.823841, -60.675833).value
            assert coords.distance_to(coords) == 0.0

        def test_distancia_boa_vista_caracarai(self):
            bv = CoordenadasRoraima.BOA_VISTA
            cc = CoordenadasRoraima.CARACARAI
            dist = bv.distance_to(cc)
            assert 130 < dist < 140  # ~135 km

    class TestToGeojson:
        def test_formato_correto(self):
            coords = Coordenadas.create(2.823841, -60.675833).value
            geojson = coords.to_geojson()

            assert geojson["type"] == "Point"
            # GeoJSON usa [lng, lat]
            assert geojson["coordinates"] == [-60.675833, 2.823841]

    class TestEquality:
        def test_iguais(self):
            c1 = Coordenadas.create(2.823841, -60.675833).value
            c2 = Coordenadas.create(2.823841, -60.675833).value
            assert c1 == c2

        def test_diferentes(self):
            c1 = Coordenadas.create(2.823841, -60.675833).value
            c2 = Coordenadas.create(1.0, -60.0).value
            assert c1 != c2


class TestCoordenadasRoraima:
    def test_todos_15_municipios_em_roraima(self):
        municipios = [
            CoordenadasRoraima.BOA_VISTA,
            CoordenadasRoraima.ALTO_ALEGRE,
            CoordenadasRoraima.AMAJARI,
            CoordenadasRoraima.BONFIM,
            CoordenadasRoraima.CANTA,
            CoordenadasRoraima.CARACARAI,
            CoordenadasRoraima.CAROEBE,
            CoordenadasRoraima.IRACEMA,
            CoordenadasRoraima.MUCAJAI,
            CoordenadasRoraima.NORMANDIA,
            CoordenadasRoraima.PACARAIMA,
            CoordenadasRoraima.RORAINOPOLIS,
            CoordenadasRoraima.SAO_JOAO_BALIZA,
            CoordenadasRoraima.SAO_LUIZ,
            CoordenadasRoraima.UIRAMUTA,
        ]

        for coord in municipios:
            assert coord.is_in_roraima()
```

## Criterios de Aceite

- [ ] Todos os testes escritos
- [ ] Cobertura >= 80% para cada VO
- [ ] Testes passando (GREEN)
- [ ] Parametrizacao para casos multiplos
- [ ] Casos de borda testados
- [ ] Erros e excecoes testados

## Comando de Execucao

```bash
# Executar testes
pytest tests/unit/domain/value_objects/ -v

# Com cobertura
pytest tests/unit/domain/value_objects/ --cov=shared/domain/value_objects --cov-report=html

# Verificar cobertura minima
pytest tests/unit/domain/value_objects/ --cov=shared/domain/value_objects --cov-fail-under=80
```
